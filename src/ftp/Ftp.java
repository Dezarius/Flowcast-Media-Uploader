/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ftp;


import gui.Window;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.util.Calendar;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.ImageIcon;
import javax.swing.JOptionPane;
import javax.xml.bind.DatatypeConverter;
import org.apache.commons.net.PrintCommandListener;
import org.apache.commons.net.ftp.FTP;
import org.apache.commons.net.ftp.FTPClient;
import org.apache.commons.net.ftp.FTPReply;
import org.apache.commons.net.ftp.FTPSClient;

/**
 *
 * @author Kristof Dinkräve
 */
public class Ftp{
    
    FTPClient client;
    Window window;
    Server server;
    Calendar calendar;
    
    private String hex_error = "89504E470D0A1A0A0000000D4948445200000040000000400806000000AA6971DE0000000467414D410000AFC837058AE900000006624B474400FE00FE00FEEB18D482000000097048597300000048000000480046C96B3E0000000976704167000000400000004000EAF3F8600000194A4944415478DACD9B798C5CD59DEF3FE7DCADB6AEDE17F7EAB65D6D1BEF3638C6097A094C0833991042202C519C27461ABD79A351F412251A5E2245CA4BF222127843C0EC2104A251200309210C2101DB02CCE2C6786D63BBDD4D2FEEF6D25B55577555DDFDFD5155EDEA72B5DD2620CD918EEEE95B55B7CFF7FBFBFDBEE79CDF3957F0F1176118BA71D55557552E5B16ABADAF6FA80B87C395BAAE878410D2F33CDF34CD4C32999C1E1B3B3BD1D77762E29D77DE49A4D3990CE07EEC9DFBA81FD8DEDECEC8C8887AE38D3736AD5FBF61F5A2458B3646A3556B82C1E01255D51AA55422BE8FE1FB689EE709DFF7F13CD7765DD7745D77C6B6ADB14C6666301E8F1F3E756AE4BD0307F6F7ECD8F1EA8865D919C0FF2F49809412CFF3C4B5D75E5B73CD35D75CB978F192BFABADADBB2A180C772A8A12F67D81E7FB80C823F0F17D1FDF07D775701C0FC771706C07C771F05C378FD5CBD8B639148F4FBED5DF7FE2E55DBB76BCB9674FF729C0F9A8C8F8AB0808040264B35971CB2DB7347FFAD39FF9C2D2A5B1DBAAAB6B36699A1E46488414E0FB7866162799C08AC7711209DC9914BE6D23A4C0F37C505564388C1289423882A707303D48674C2CD344E023849FC964660E0D0D7DF01F3B76BCF2879D3B770E00D65F4BC48726E08517FEC8F6EDF7575F7FFD17BFB462C5CAFF5157D7B041D70D1529F13D87ECF818D3277A9939D18B3332821F8F234C13E13808CFCBF75B20840029415140D7211884AA2A6463135A5B3BA2611159A9914C65706C1B4D531CD39C39D2DBFBFEAF7EFFFBDF3D7BE8D0A1D1BFC6232E998055AB56D1D3D3A37CFFFBDFDF72E5959FFC4E7B7BC7E70281A0819458E91413477A98DAF30E4E5F1F329140DA36BEE3E0BB2EBEE7E1FB45FD1422D701296789908A82545584AE4330805F558D686F478DADC0A9AE279ECC60992686A15A89C4C4EB6FBFBDFBDE5FFEF2F15DC00CE07DAC047CE73BDF61CF9E77A2DBB6FDF73B366CD8F8ADDADABA56A1A898E914A7BAF730B16B170C0EA06432F89685E738E7000B91BF88B9EDC26765EE092951340D190C4245055E7B3BCAAA35D8D50D4CC46710F8288A77A6B7F7C8C34F3EF9C463FDFD1F9C2237722CD81B94857EF1DD77DF65D7AE5D6D77DCF10FFF77F3E64F7CB3B6B6AE062138DD7390134F3D49E6D557504647F153293CD3C477DD39E0441ED06CBB00BACC3D51F00821F03D0FCFB2209D469D9A82919388CC0C91E6265CCD209DB6224D4DCD5B57AF5EB538954A1E1B1A1A9ABA144F581001BEEF73D75D77ADBCE5965BEE5FB76EFDCDE148853A339DE0E8EF9E65ECE9DFA00E7C90036E59E0FBF3032B065EE6DE053F073CDBC64FA751262761EC347A4508A3A1814432A344A3952B57AE5CB1DAF7DD63BDBDBD6759E01CE2A204F8BECFB7BFFDED3537DD74D3C3AB57AFB95A0F04C4990FFA39F2D8A338AFBD86128FE366B317065E6451E6B9278A7E7BC17B806759C8540A757C0CE13B84DBDA98CE5842D782EDB1D8B2759EE7BCDFDBDB7B7A21245C90807DFBF6F3E31FFF78F98D377EF9A1CB2E5BF5294DD71938B09F630F3D88D2D393B3BAE35C92C529B97731AF281B4252E6043593419D9A44981942ED6DA46C0F45D117C5624B5767B3E99EFEFEFE8B92302F01BFFAD5AF78E289279A6FBDF5B6FB56AD5AFD5955D3F860DF7BF43FF2305A7F3F6E3A7D7E8C2FC0A20BD5818512EA5B16CA740269A609B4B793B23D342DD0BC644967E7E8E8C9BDA74F9F9EBC90269425E0273FF909F7DE7B6FF81BDFF8C60FD6ADDBF055231010433D87E87FF411B481819CCB97805FA8452F6AF14B0D2129F11D07657A1AC536D1DBDB99CED84422151D1D1DEDD1EEEE77BA4DD34CCD47C27904DC70C317B9FFFEEDE2473FFAD1D7376FDE72673852A19F1D1EE2C4638FA0F5F6E6C05FC0A2BEEF97B5F24274A02C41F9228ABCA91CE1BEEB22130914E1A3B5B5934866445D5D5D5763637DE2EDB7DF3AC83CB3C6F308D8B1631752CA0D575FFD37FF5657D7D0989E4972F4A927510FEC9F055FCEA23E80AE13686DC5055CCB424A796E9273312F29278A805A5545B0BD1D3393C1779CDC33E7F11A5C1725398D120E424313A974566D69591433CDCCC113277A87C8CD18E727E09E7BEEE1EB5FFF7AF89FFEE97FFE9FCECE659F41087A5F7E09FBD55720959A7FAC06080659F2B5AFB1EA5FFE85BA4D9B18EBEFC79C9C4459A8DA9790E3F93E465B1BCDDBB6D17AC30D54B4B63276F42898264AE1F7A5644809B68D924AA2343591D58248A1449B9AEAA3BB77BFFEA66DDBD3A5A1304B40341AE5F9E79FC7F3FCCF6FDA74C5FF0E0443C699BE5EC69F791A756C6C76982BB55E31F8CE9B6F460985A8686DA576E54ACE1C3B865D448258A028FA80D1D646D3EDB7E32E5A446266869A588CCAE666C6DE7F1FF2DE55567885C891E458C88E0E92698BEAEA9AD650C818D8B76FDF11C02E0E055968DC75D75D6CD9F289AAD5ABD7FC632814AEC866D29CFAF3CBE8A74FE37B5E59EBF90081004BB66DA3F3A69B108A02BE8F6D5954C5626CFEF6B7316231ACC21CE162A228257EDEF24DB7DF8EDBD88899CD6266B30C0E0D125EBB961577DC811B8DE6C6B6324422656E9975F224C1914142A100B6ED85366DDA7C6B4343433BA096F580175E7881A9A9F8DFAE59B3FE7F6946403FD37388CC9F5E4294B87EB138896090A5DBB6D1F9E52F23D439CFC5735DC20D0DD4AE5CC9D9E3C7B14AC2A19C0016C037E6C15BA699CB0F781EBEE7939C99A1BEAB8BAABC2708DB46CEA72F9E87626611ED1DA46C9F6845A45E5144DFFEFDFB8E00E61C0FF8D77FBD13C3D0435D5D2B6E318C40D8CCA499DCFD066A3C7E6EB82B557B45A1E3E69B739657D55C889414DBB2A85AB68CCBBFF52D8C580CBB288C4A05700EF8868659F0BEEF2384C8255D5C9793278709AF5D4BECF6DBB1751DBF9C574999AB93130446060906741C87C0DAB5EBFF5ED3D4C6622F50001E7DF417E8BAB66EE3C62BEE3402A1C8C4077D64FEF232CACCCCFCCA1D08B0F4AB5F25DCDA9A0B91798AE7BA84EBEBA959B182B3459A50FCDC59F0B7DD3607BCE779F9AF89593BF8BE4F269BA5AEB98553DDDDC86C768E17CCE9A30FD2B1F1DB3B48DB1ED168A46A7A7AAABBAFAFEF83BC16209B9B9B59B1A28B952B2FBB26180C35D98E43E2E001D444027F9EE149488967598CEEDE8D5398175CA0D89645D5D2A55CFECD6FCED18482E5F5B6369A6EBBED3CB7CF3DF61CF84202C5D07546F6EEC54E26CFD39239554A647C8AC0E418AAA6A2287ACDC68D975F05440A0F96DBB66DA3B37371457D7DE367409249C4B18F1FCD656EE6516C84401182E1975EE2D8D34FE3D9F64549B04C93F0E2C56CFCC637082C5B86EDFB7805F0B7DE9A039FCD9E07FE9C07E4FA100947481F39C2C00B2F1070DD7323CC3CA30CAE8B3A3A8CA10A1CD7A7ADAD637324126E288481F2DDEF7E0FA06BC3864DDFD4F4403431F401CEEED7919675D18589F43C268F1DC3F17D6A57AECC8D02658AEFFBB8AE8B99CDA25555517FD9658CF7F622C3619A8B2CEFBA2EDE3CE12484A0221221FDFEFB0C3EFF3CE16C16435573FA5046A38A3D43BA2E4E6B3B595F120C1A81E1E1C13786878707005BBDEEBACF71F8F0E1959AA637B89E4B269FD129ABFA052BE7EF4921301C87C1679F052158FE95AF20356D8E2016C0DBB68D6DDBA4D369027575ACFEE77F66727C1CABB2924C3249369BC5B66D3CCFCBA9BEEF170FD754575531F4E28B1C7BE411AA1D07110C62854268E1306A388C120CA21846CE0839B138D7E74C063D11475637A2696A552CD6B57CF7EEDDAF01695508C1E38F3F7199108A665B16F6C849029E9763340F760EF0927B42080CD765E8B9E71042D075F3CDB3249482B76D1BCBB2989E9EC6B26D5252923E7D9A6CDEF58B499E8D2821A8AEAC6462C74E0EDE7D37D1E9691C60BAF0B194485D470906D1A3518CDA5A8CDA5AF4CA4A944060566495F8044A6D13522A6A6B6B5B0C0801091530229148CCF77DAC4C0626C6119013C00B002FF60A25EF0943BFFB1D0841D74D3721557516BC6559643299D99ACD66314D13D334B12C0BD775E711BC9CE5A7DFD8CDA1BBEFA6727A9A9010731399BE8F679AB8D92CD6D414334343484D43ABA820D0D040A8B999406D2D6A328902781ED4D4D4B6E785505163B165615D0FB4789E8F3D9342A452731730452E2F4A80177F5E0887E1DFFF1E21254BAEBF1ECB75CF036D59D6A583FFD9CFA828025F4E6E670D432E75664E4C604E4C30DDDB8B515585B1761C7FF95A44459448A4A22112894452A994942B56AC88A8AA5AE37A1ECE4C0A699A653338175DCF4B89A228A8E934477EFE73BAEFB9875422413A9DFE48C0878540CE037E9684E25AB44CCE8E8F33BEA79BE4A9518490188611ADABABAD0014351AAD0C0A21C39EEFE364B208D73D7F52514600E7C4AB9478B64DFAEC595243436412097ADE7F1F339DA6FD6B5FC3749C4B025F158DCE828FE6C18B3260E72361363A0A7F0B01B685954C8010A8AA1E0C87C34140AA8661684208DDF33C5CCB44292434162080857BD9F171920303981313F89E8702044D93DE071E405656527DDD750B028F80DABA3ACCC33DBCF7D39F52934C9E07BEB42D8A3E2F0ED17312911B0D14DFC7362DA414A8AAA26A9AAE034205723BB4AE876B59B9B9F13CC08B7540088193C9901A186066642437192A29D5EDED843A3AC864320BB2BC5424A15090A635ABE9EBECC43D78F082A06541134A4898B32AC98F023E9075DD4268CC468A741CC7F33CCFF37C3FB7A829B7F22B493A08203B36C6C4BE7D240706CE03EF01A1588CA5DFFB1E7E67279974FAA2E01545C1D075A6A713F88DF57CEEC10708AD5B8799EFBC00142150A44415022D7F558BAFF9AA15D5C2DF85ED3699F36ECF755D1FF0652A95B25CD7CDF89E87AFA8F8E592162553CBE9FE7E260E1CC04A24CEB3BA07046331167FF7BBD81D1DA4676616045E37347443C73074A6A7A7503A5AB8FAC10708AE5B87E5FBB3C0CF035D74D5F2ED02F0D9EF0B81A2A8482380A2485CD7313399B40520474747671CC79EF63D1F8C006E7E7A596E79E966B34C1E3E4CA2B7B7ACCB9782CF5C0A783D07BE40423A9D24B47C29D73CF410A1F5EBB13D0F590CACD8DAC57FE7E725C564685282A12323115445C1B6ED743C9EC8009E7CF7DD3D33A6698EFBBE873002B846E0FC214F4AEC6492890307488F8E965DFB7F74E00B9E60605B26D5EBD670F5C30F1358BF1EC7F3508A2D5F02BC9814B5C40BBC7004355A89AA2ACCCCA4E2E3E3E329C0938EE365D2E99941DFF7117A002712C97734BFC090126B6A8A8903073027272957DC0F013E180C108984662D5E0ADED0031846103C8F45575CCEA71F7E183DEF094A71CC9721412B254508DCEA5A0255552852323535799ADC76BA2B013B1E9F3A063E425171AB6B67B32C08813939C9C4C183D8D3D365C11704EF52C057555632B3A79B337FFC4FC2BA811E280F3E770D20102CBAE20AAE7AF0C11C09C59A508684E21050A5449102BBA595504514217C464747068034E04ADFF7FDD1D1911ED77572081B9A70F2316FC5E34C1D3A84934ACD0BFE522D5F5D554572F79B1CB9FB1E861E7890334FFF96A0A6A1078CB2E055459D1D929BAEB8822B1F780075ED5A2CCF2B2F862521A00981AFE9B03446381CC2B6AD746FEFF13E20A70100FBF7EF3B619A99217C90F58D6483419C6492A9C387B12F047EE9D24B065F98E1554D4F536D9A0C3EF22883BFFC35865473C0E7015F288D975FCEE6EDDB51D7AEC5F1FD7342A728A88A82AAAA68AA9ABB2A0A9A94642AABD0635D040C9D787CEAECE1C387FB802CE04B21043B77EE3C138F4F764B094A4515C95084C9C387CB0E73B3455569BEE30E9CCECE4B065F98DE6A4210CC66F9E08187E87DE817E828048CE0BCE00BA5E1F2CB59FDC31F62575521140545D3500D032D10400D045083C1DC351040D175924B6354B677A02A928181FEF747464646C96F9515F605B2838303AF82674A45C5AC6D207521F07902445515D96CF643AFEA005421089959FAEEBB9FC3F7DE8FE2F968AA362FF842D11B1A70C361A461E400CF539D8A0AAC8D97535953836D9BF6BE7D7BF70093E493A2B3392C299959B76EC3358AA235118E3073683F7A7C6ADE0EB88E83994A11DDB001531426A0F3833F58647959F41C01285262B82EE37BF762FB3E8BB66C41D1B479FF77F2D429DEF9C10F90478F52190CA2EA3A4ABE4A4DCB9D2B52551445E17463137CFE06EA9B1A181E1E1878E491879E48269327C889E03902060707D35BB76E6DAEADA9BFCA5375B2660679E8C09CCE52D2F1D4E020D6D818B59B3661ABB92CD0A5822F10A04989E1798C757763B92E8DF390903C758A37EEBC13EBD557690A850818068A61E4B2429A367B555415475519DABC95A6AD9F44571576ECF8CB8B2FBDF4D21F81B3E77900E05555554E2F5FBEE25A50AA444D2DE9F70FCDEB05825C5A756660007B7C9CDA8D1B7134354F82381F3C73172D8567C8FCB0A5E4155BF73CC6BBBB313D8FC64F7C22975E2B03BE2512211C08A0E60998F580BC17A88AC2486D1DDEE7AFA7B1A59953A74E9E79E8A1071F3D73E6CC41209977D9B9BBC33D3D3D89AD5BAF6CAAADA9BFD2D7026455150EEE43992F535B4AC2A68D788100959108C93776CFE6F042E4B7A04A97AE79025429CF9190F7848977DFC5745D1AF224244F9DE2F53BEFC47AE5155A4BC1177B41DE03329AC6E0E6ADB46EDE82AA08FEFCE73FFDE76F7FFBCCB3C0297202C8790400AEA6A9672FBB6CE57F938A56A7362E22797A04FDE4F00513102A30333848E6E4084630C8F86BAFD1FBF8E3B94C4E11F862E0C5EE5F005F686B5212F03CA6F6EE25393989659AECBBFB6ECC9D3B690D8709958057757D4E5B280AC79B5B095FF779EAEA6BE9EFEF1DBEF7DEFFF7E0F8F8F8212041D116792901FEF1E3C7E3AB565DA6B434B77EDA4351454B0BE92387D09349B80809E6F030E3AFBD4E6AFF0122A649A8082817717F25DF568B49F07D66DE7B8FB32FBE883A38486328443010402BB1BC521406AAA671321C2671F5E7E858B19C6C66C6FEF77F7FEAD72FBFFCF28BC0E942ECCF47008037383830B871E3C6AE8A8ACA15325C81555D8D7BF800AA65315F2990A0FB3E01402BB1F6BC041479805A42882A25414521ACAA540483188651DEF2BA8E9AFF2CAE69F46FBC82C5576EC5D05576EDDAF9E6DD77FFEC51DBB67B811425F9927204F8F17822A3AACAD08A15CBB7AA8A5EA735B590D154387A04C5BDF0D1BBE2C464F1BD8578802CF2846212544D43CD0B5C41EC8A2D5F009F51358E74ADA0E59ACF525D59414FCFE1A19FFDECAE9F0F0F0F7703135CEC884C3109478F1E1D5BB4A869A2B3B3F32ADF97A1E09265CC081F4E1CBF2809B3A02F4280924FA7CF12514A8210B9C3D385E12DEFE24A311979F0594DE348E712EA3FF7B73434D67372782871FFFDF73DB46BD7CE97C9099F59AE9F173A28E97577EF1988C5965A6DADAD5B5C4FEAA1E52B494B81D7D78BE2385CA85C8880828714839DD32E90924FB52BF9C94D619C2FF6044DD348A92A479775D1F0775FA0B97911636367328F3DF6C893BFFEF553CF0003E496BE650F505F88001F70DE79E7ED63B1584CB6B4B46C723DA185565C86198D62F7F5A29AE6BC3F2E1DEECA125064FD396D29E7B415553D474261A2939FEC4CEA3AFDEB37D1F685EB59D4B288F1F1B3E6134FFCF2E9FBEEBBEF57C00972BB68977650B29804D7F5CCBD7BBB0F777676782D2D2DEB3D4F1AA1A55D789D9DA44F0EA14C4D95DFA9592001E781CFCF1667DBF984A6D4B45C5555143597BB1CA9AE61E26FAEA5EBF37F4F43431DA32323E95FFCE2D1DFDC7BEFBF3DEE79DE7120CE873D2A5B543CCBB2B36FBEB9FB504BCBA2E9D6D6967552A861BD7111814D5790766DBCD11194921CE1C5420072F38359E0F37884140245557324280A525148190643ABD7A07FE556967FEA534423618E1F3F36B57DFB7D4F6CDFBEFDA93CF829CA88DE872100C0F33CCF7CEBAD377B8241E383B6B696AE6020D4801EA462E315F85D31D2D3D3F813E3B302B9101114E5C0161351682B0A524AB286C199588CCC97BE4CEB976EA275E9127CD7E1EDB7DFEAFBE94FEFDAFE9BDFFCE659A02F6FF98B82BF1402201747D6C18307FAC6C6CEEC6D6A6A0CD7D6D67682D4F5C6662AB67E0A6FD932B2B6851B8F232C6BEE5EDE3CC3A02CB2BE524A447E4F20138930B5662DD99BBE42FD6D5FA56DFD462A2261C6C6CE66FFF087E777FCE8473FFCF95B6FBDF50A304C2EE617FCBEA158E8178B8A04F46834DA74EBADB77D61CB964FDE515353BFC6F584923B35E29019EA67A6FB1DACFDEFC1F0304A2A85F4BC59428A436036795934FE0B4DC3ABA8C06B6B436ED844F8939FA27AF51AA2D535E8AA422693767B7A0EF53EF3CCD3CF3DF7DC737F364DB38FDC1A3FCB25BE37F4610828FC4E01C2CB972F8F5D7FFD17BFB47AF5BA1B2A2B6BBB10521542A2A80ABE99C13A7B8A4C7F1FD6403FEEE828DEC404A467C07672A9712150341D251241ADAF436D6E21B03446A8AB8B48C762C2D535E8BA8E22209349BB7D7D27065E79E52F7F79F6D9FFF8D3E8E8E851724BDB141FF2CDB10F4B40B1376840C5F2E5CB977DF6B3D75EB36AD5DAEB1A1B9B56EB7AB052082984944855C91D8DF35C706C7CDB02D72D6C53E5525AA1502EA5A51BA8AA862273A1E0798E9F48C4537D7DBDC7DE78E3F5D75E7AE9A5D74F9E3C791C1823B7ACB52ED5EA1F2501A54484A3D168D3D6AD5BD7AE5FBF614B4747E7C69A9ABA25E170A4565535435154210BAFC6498994022995DC5588FCD11ECFB76DCB9C9E9E8E9F3E3D3A78F4E891C36FBFFDF6DE77DF7DF7483A9D1E212770A9BF16F8474D4031112AA00361C3306ABBBA62AD5D5DCB3B5B5ADA16D7D5D5B544A39575C16020AAEB4640082101DFB2AC6C369B49251289C9B367CF9C1A1C1C183E76ECD8507F7FFFA86DDB13E4842D4D2EC69D8F02F8C74540F1730B3AA1E5AB01048020A04B29352190B997A77D97DC32D52CA976BE16E2FBBFE6CBD3974088CCD7D245A35F54BD7CFD58009796FF0F84FDB944837FE65C0000002E7A5458746372656174652D64617465000078DA333230B0D035B0D03532093130B03232B33236D53530B532300000420B0517E51AAC560000002E7A5458746D6F646966792D64617465000078DA333230B0D035B0D03532083134B132B2B032B1D03530B532300000423E051E4D842F39000000227A545874536F667477617265000078DA734CC94F4A55F0CC4D4C4F0D4A4D4CA904002F9C05D4AE0CA94D0000000049454E44AE426082";
    
    public Ftp(Window window){
        this.client = new FTPClient();
        
        
        this.window = window;
    }
    
    public boolean logIn(Server server) throws Exception{
        //window.getLBIndicator().setIcon(new ImageIcon(DatatypeConverter.parseHexBinary(window.getHexYellowLight())));
        try {
            this.client = new FTPClient();
            this.client.setConnectTimeout(2000);
            this.client.setDefaultTimeout(2000);
            
            this.client.connect(server.decrypt("server", true), 21);
            if(!FTPReply.isPositiveCompletion(client.getReplyCode())){
                client.disconnect();
                window.setLBLoginStatus("FTP server refused connection.");
                server.deleatKey();
                return false;
            }
            System.out.println("FTP");
            
            boolean login = this.client.login(server.decrypt("user",true), server.decrypt("pass", true));
            if(login){
                this.client.enterLocalPassiveMode();
                server.deleatKey();
                return login;
            }
            else {
                window.setLBLoginStatus("Login failed");
                this.client.disconnect();
                server.deleatKey();
                return login;
            }
        } catch (IOException ex) {
            try {
                this.client = new FTPSClient("SSL", false);
                //this.client.addProtocolCommandListener(new PrintCommandListener(System.out, true));
                this.client.setConnectTimeout(2000);
                this.client.setDefaultTimeout(2000);
                
                this.client.connect(server.decrypt("server", false), 21);
                if(!FTPReply.isPositiveCompletion(client.getReplyCode())){
                    client.disconnect();
                    window.setLBLoginStatus("FTP server refused connection.");
                    server.deleatKey();
                    return false;
                }
                System.out.println("FTPS");
            
                boolean login = this.client.login(server.decrypt("user",false), server.decrypt("pass", false));
                if(login){
                    this.client.enterLocalPassiveMode();
                    server.deleatKey();
                    return login;
                }
                else {
                    window.setLBLoginStatus("Login failed");
                    this.client.disconnect();
                    server.deleatKey();
                    return login;
                } 
            }
            catch(IOException ex1) {
                server.deleatKey();
                window.setLBLoginStatus(ex1.getMessage());
                return false;
            } catch (Exception ex1) {
                throw new Exception("wrong password", ex1);
            }
        } catch (Exception ex) {
            throw new Exception("wrong password", ex);
        }
        
    }
    
    public boolean logOut(){
        try {
            this.client.logout();
            this.client.disconnect();
            return true;
        } catch (IOException ex) {
            System.out.println("Oops! Something wrong happened");
            window.setLBLoginStatus(ex.getMessage());
            return true;
        }
    }
    
    public boolean connected(){
        return this.client.isConnected();
    }
    
    public boolean testConnection() {
        try {
            return this.client.sendNoOp();
        } catch (IOException ex) {
            System.err.println(ex.getMessage());
            window.setLBLoginStatus("Connection lost");
            
            return false;
        }
    }
    
    public void upload(File movie, String dozent, String titel, String beschreibung, String workflow){
        
        new Thread( new Runnable(){
            @Override 
            public void run(){
                
                calendar = Calendar.getInstance();
                
                String metadaten = dozent + "\n" + titel + "\n" + beschreibung + "\n" + workflow;
                String dateiname = dozent + "_" + calendar.get(Calendar.DATE) + "-" + (calendar.get(Calendar.MONTH) + 1) + "-" + 
                                    calendar.get(Calendar.YEAR) + "_" + calendar.get(Calendar.HOUR_OF_DAY) + "-" + 
                                    calendar.get(Calendar.MINUTE) + "-" + calendar.get(Calendar.SECOND);
                
                
                FileWriter fw;
                File meta = new File(movie.getParent(), dateiname + ".txt");
                
		try {
                    fw = new FileWriter(meta);
                    fw.write(metadaten);
                    fw.close();
		} catch (IOException e) {
                    JOptionPane.showMessageDialog(null, "Could not create Metadata!", "Error", JOptionPane.ERROR_MESSAGE, new ImageIcon(DatatypeConverter.parseHexBinary(hex_error)));
                    meta.delete();
                    window.setLBUploadStatus("Could not create Metadata!");
                    return;
                }

                try {
                    client.setFileType(FTP.BINARY_FILE_TYPE);
                    byte[] bytesIn = new byte[4096];
                    int read = 0;
                    long groeße = (movie.length() / 1024) + (meta.length() / 1024);
                    window.getPBProgress().setValue(0);
                    window.getPBProgress().setMinimum(0);
                    window.getPBProgress().setMaximum((int) groeße);
                    
                    window.setLBUploadStatus("Upload ...");
                    
                    String fileMeta = "/Metadaten/" + dateiname + meta.getName().substring(meta.getName().lastIndexOf('.'));
                    String fileMovie = "/Input/" + dateiname + movie.getName().substring(movie.getName().lastIndexOf('.'));
                    
                    InputStream inputStreamMeta = new FileInputStream(meta);
                    OutputStream outputStreamMeta = client.storeFileStream(fileMeta);
                    
                    while ((read = inputStreamMeta.read(bytesIn)) != -1) {
                        outputStreamMeta.write(bytesIn, 0, read);
                        window.getPBProgress().setValue(window.getPBProgress().getValue() + (read/1024));
                
                    }
 
                    inputStreamMeta.close();
                    outputStreamMeta.close();
                    
 
                    boolean completedMeta = client.completePendingCommand();
                    boolean completedMovie;

                    if(completedMeta) {
                        InputStream inputStreamMovie = new FileInputStream(movie);
                        OutputStream outputStreamMovie = client.storeFileStream(fileMovie);
                    
                        while ((read = inputStreamMovie.read(bytesIn)) != -1) {
                            outputStreamMovie.write(bytesIn, 0, read);
                            window.getPBProgress().setValue(window.getPBProgress().getValue() + (read/1024));
                        }
                    
                        inputStreamMovie.close();
                        outputStreamMovie.close();
                    
                        completedMovie = client.completePendingCommand();
                    } else {
                        window.setLBUploadStatus("Upload Metadaten failed!");
                        return;
                    }
                    
                    if (completedMovie && completedMeta) {
                        window.setLBUploadStatus("Upload successfully");
                    }
                    else {
                        window.setLBUploadStatus("Upload Movie failed!");
                    }
            
                } catch (IOException ex) {
                    window.setLBUploadStatus("Error: " + ex.getMessage());
                    try {
                        client.disconnect();
                    } catch (IOException ex1) {
                        window.setLBLoginStatus(ex1.getMessage());
                        
                    }
                    window.getBConnect().setText("Connect");
                    window.getLBIndicator().setIcon(new ImageIcon("red_light.png"));
                }
                finally{
                    meta.delete();
                    
                    window.getBConnect().setEnabled(true);
                    window.getBFileChooser().setEnabled(true);
                    window.getBUpload().setEnabled(false);
                    window.setUpload(false);
                }
            }
        } ).start();
    }
}
